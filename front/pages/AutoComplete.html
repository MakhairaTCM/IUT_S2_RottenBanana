<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Movie Search with Poster</title>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <style>
        #movie-posters {
            display: flex;
            flex-wrap: nowrap;
            gap: 10px;
            margin-top: 20px;
            overflow-x: auto;
            white-space: nowrap;
        }
        .movie-poster-card {
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 4px;
            background-color: #f9f9f9;
            text-align: center;
            flex: 0 0 auto;
        }
        .movie-poster-card img {
            max-width: 100px;
            height: auto;
            display: block;
            margin: 0 auto 10px;
        }
        .movie-poster-card p {
            margin: 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="form-group">
        <label for="input-movie">Movie Title</label>
        <input type="text" class="form-control" placeholder="Movie Title" id="input-movie">
        <!-- <button id="search-button">Search</button> -->
    </div>
    <div id="movie-posters">
        <!-- Movie posters will be displayed here -->
    </div>

    <script>
        // version js vanilla

        document.addEventListener('DOMContentLoaded', function () {
            fetchRandomMovies();
        });

        function fetchRandomMovies() {
            fetch("https://api.themoviedb.org/3/movie/popular?api_key=a78671649d9627eedd795ddb4114bf73")
                .then(response => response.json())
                .then(data => {
                    const movies = data.results;
                    const shuffledMovies = movies.sort(() => 0.5 - Math.random());
                    const randomMovies = shuffledMovies.slice(0, 20);
                    displayMovies(randomMovies, '#movie-posters-random');
                })
                .catch(() => {
                    document.getElementById('movie-posters-random').innerHTML = `<p>Sorry, could not fetch movies.</p>`;
                });
        }

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('input-movie').addEventListener('input', function () {
                const query = this.value;
                if (query.length >= 2) {
                    searchMovies(query);
                }
            });
        });

        function searchMovies(query) {
            fetch(`https://api.themoviedb.org/3/search/movie?api_key=a78671649d9627eedd795ddb4114bf73&query=${query}`)
                .then(response => response.json())
                .then(data => {
                    const movies = data.results.map(movie => ({
                        id: movie.id,
                        title: movie.title
                    }));
                    displayMovies(movies, '#movie-posters');
                })
                .catch(() => {
                    document.getElementById('movie-posters').innerHTML = `<p>Sorry, no movies found.</p>`;
                });
        }

        function displayMovies(movies, containerSelector) {
            const moviePostersContainer = document.querySelector(containerSelector);
            moviePostersContainer.innerHTML = '';
            movies.forEach(movie => {
                fetch(`https://api.themoviedb.org/3/movie/${movie.id}?api_key=a78671649d9627eedd795ddb4114bf73`)
                    .then(response => response.json())
                    .then(movieDetails => {
                        const posterPath = movieDetails.poster_path;
                        const posterUrl = posterPath ? `https://image.tmdb.org/t/p/w500${posterPath}` : '../assets/placeholder.jpg';
                        const moviePosterCard = document.createElement('div');
                        moviePosterCard.classList.add('movie-poster-card');
                        
                        const posterImg = document.createElement('img');
                        posterImg.src = posterUrl;
                        posterImg.alt = `${movieDetails.title} Poster`;
                        posterImg.classList.add('movieImg');
                        
                        const movieTitle = document.createElement('p');
                        movieTitle.textContent = movieDetails.title;
                        
                        const voteIcons = document.createElement('div');
                        voteIcons.classList.add('vote-icons');

                        const upvoteIcon = document.createElement('img');
                        upvoteIcon.src = '../assets/likeblue.png';
                        upvoteIcon.classList.add('vote-icon');
                        upvoteIcon.alt = 'Upvote';
                        upvoteIcon.addEventListener('click', () => handleVote(movie.id, 'upvote'));

                        const downvoteIcon = document.createElement('img');
                        downvoteIcon.src = '../assets/dislikered.png';
                        downvoteIcon.classList.add('vote-icon');
                        downvoteIcon.alt = 'Downvote';
                        downvoteIcon.addEventListener('click', () => handleVote(movie.id, 'downvote'));

                        voteIcons.append(upvoteIcon, downvoteIcon);
                        moviePosterCard.append(posterImg, movieTitle, voteIcons);
                        moviePostersContainer.appendChild(moviePosterCard);
                    })
                    .catch(() => {
                        const moviePosterCard = document.createElement('div');
                        moviePosterCard.classList.add('movie-poster-card');
                        
                        const posterImg = document.createElement('img');
                        posterImg.src = '../assets/placeholder.jpg';
                        posterImg.alt = 'No Poster Available';
                        
                        const errorMsg = document.createElement('p');
                        errorMsg.textContent = movie.title;
                        
                        moviePosterCard.append(posterImg, errorMsg);
                        moviePostersContainer.appendChild(moviePosterCard);
                    });
            });

            if (containerSelector === '#movie-posters' && !searchResultsAdded) {
                const section = document.querySelector(containerSelector).parentElement;
                section.classList.add('mb-3');
                const h2 = document.createElement('h2');
                h2.textContent = "Search Results";
                section.insertBefore(h2, section.firstChild);
                searchResultsAdded = true;
            }
        }

        function handleVote(movieId, voteType) {
            alert(`${voteType}d movie with ID: ${movieId}`);
        }

        let searchResultsAdded = false;
    </script>
    
</body>
</html>
